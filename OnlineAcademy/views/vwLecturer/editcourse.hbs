{{#section 'css'}}

{{!-- ----------- --}}
{{!-- Import ZONE --}}
{{!-- ----------- --}}
<!-- Filepond stylesheet -->
<link href="https://unpkg.com/filepond/dist/filepond.css" rel="stylesheet">
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<link href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css" rel="stylesheet">
<link rel="stylesheet" href="/views/assets/css/filepond-custom.css" type="text/css">
<link rel="stylesheet" href="/views/assets/css/quilljs-custom.css" type="text/css">

{{/section}}

{{#section 'js'}}

{{!-- ----------- --}}
{{!-- Import ZONE --}}
{{!-- ----------- --}}
<!-- Load FilePond library -->
<script src="https://unpkg.com/filepond-plugin-file-validate-size/dist/filepond-plugin-file-validate-size.js"></script>
<script src="https://unpkg.com/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.js"></script>
<script src="https://unpkg.com/filepond-plugin-image-validate-size/dist/filepond-plugin-image-validate-size.js">
</script>
<script src="https://unpkg.com/filepond-plugin-file-rename/dist/filepond-plugin-file-rename.js"></script>
<script src="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js"></script>
<script src="https://unpkg.com/filepond/dist/filepond.js"></script>
<!-- Include the Quill library -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>


<!-- Turn all file input elements into ponds -->
<script>
    // Register the plugin with FilePond
    FilePond.registerPlugin(
        FilePondPluginImagePreview,
        FilePondPluginFileValidateSize,
        FilePondPluginFileValidateType,
        FilePondPluginImageValidateSize,
        FilePondPluginFileRename
    );

    FilePond.setOptions({
        server: {
            process: (fieldName, file, metadata, load, error, progress, abort, transfer, options) => {

                var func = (fieldName, file, callback) => {
                    console.log("Send Data");
                    const formData = new FormData();
                    const request = new XMLHttpRequest();
                    formData.append(fieldName, file, file.name);

                    const courseId = "{{detailCourse.id}}";
                    if (fieldName === "coverImage") {
                        request.open('POST', `/lecturer/editCourse/image/${courseId}`);
                    }
                    else {
                        request.open('POST', `/lecturer/editCourse/section/${courseId}`);
                    }
                    
                    request.upload.onprogress = (e) => {
                        console.log("On Progress");
                        progress(e.lengthComputable, e.loaded, e.total);
                    };
                    request.upload.onloadend = (e) => {
                        console.log("On Load End");
                        callback(null);
                    };

                    request.onload = function () {
                        console.log("On load");
                        if (request.status >= 200 && request.status < 300) {
                            // the load method accepts either a string (id) or an object
                            load(request.responseText);
                        }
                        else {
                            error('oh no');
                        }
                    };
                    request.send(formData);
                    
                };
                if (currentUploadPond === null) {
                    currentUploadPond = [];
                }
                currentUploadPond.push({
                    fieldName: fieldName,
                    file: file,
                    callbackSubmit: func
                });

                return {
                    abort: () => {
                        console.log("Cancel");
                        abort();
                    }
                };
                
            }
            
        }
    });


    // Get a reference to the file input element
    var pondCourseVideo = new Map();
    var pondPreviewVideo = new Map();
    const inputElementPondCoverImage = document.querySelector('input[type="file"]#main-information-cover-img');
    const pondCoverImage = FilePond.create(inputElementPondCoverImage, {
        maxFileSize: '10MB',
        imagePreviewHeight: 500,
        acceptedFileTypes: ['image/*'],
        fileRenameFunction: (file) => {
            return `photo${file.extension}`;
        },
        imageValidateSizeMinWidth: 600,
        imageValidateSizeMinHeight: 400
    });


    document.querySelectorAll('input[type="file"]#main-information-course-video').forEach((ele, index) => {
        InitPondVideo(ele,null,index);
    });
    document.querySelectorAll('input[type="file"]#main-information-preview-video').forEach((ele, index) => {
        InitPondVideo(null, ele,index);
    });

    // Create the FilePond instance

    function InitPondVideo(inputElementPondCourseVideo, inputElementPondPreviewVideo,index) {
        if (inputElementPondCourseVideo) {

            const instance = FilePond.create(inputElementPondCourseVideo, {
                acceptedFileTypes: ['video/*'],
                fileRenameFunction: (file) => {
                    return `${index+1}${file.extension}`;
                }
            });
            pondCourseVideo.set(index, instance);
        }
        if (inputElementPondPreviewVideo) {
            const instance = FilePond.create(inputElementPondPreviewVideo, {
                acceptedFileTypes: ['video/*'],
                fileRenameFunction: (file) => {
                    return `${index+1}${file.extension}`;
                }
            });
            pondPreviewVideo.set(index, instance);
        }
    }
    
    // Initialize Quill editor
    var toolbarOptions = [
        ['bold', 'italic', 'underline', 'strike'], // toggled buttons
        ['blockquote', 'code-block'],

        [{
            'header': 1
        }, {
            'header': 2
        }], // custom button values

        [{
            'list': 'ordered'
        }, {
            'list': 'bullet'
        }],

        [{
            'script': 'sub'
        }, {
            'script': 'super'
        }], // superscript/subscript

        [{
            'indent': '-1'
        }, {
            'indent': '+1'
        }], // outdent/indent

        [{
            'direction': 'rtl'
        }], // text direction

        [{
            'size': ['small', false, 'large', 'huge']
        }], // custom dropdown

        [{
            'header': [1, 2, 3, 4, 5, 6, false]
        }],

        [{
            'color': []
        }, {
            'background': []
        }], // dropdown with defaults from theme

        [{
            'font': []
        }],

        [{
            'align': []
        }],

        ['clean'] // remove formatting button
    ];

    var quill = new Quill('#editor', {
        modules: {
            toolbar: toolbarOptions
        },
        theme: 'snow'
    });
</script>

<script>
    jQuery(document).ready(function () {
        (function () {
            var showChar = 400;
            var ellipsesText = "...";

            //jQuery(".truncate").each(function () {
            //    var content = jQuery(this);
            //    var contentHTML = content.html();
            //    if (contentHTML.length > showChar) {
            //        var truncateText = contentHTML.substr(0, showChar);
            //        var fullText = contentHTML;
            //        var html =
            //            '<div class="truncate-text" style="display:block">' + truncateText +
            //            ellipsesText +
            //            '<div class="container-fluid" style="display: flex; justify-content: center;">' +
            //            '<button type="button" class="btn btn-primary moreless more">Show More</a>' +
            //            '</div>' +
            //            '</div>' +
            //            '<div class="truncate-text" style="display:none">' + fullText +
            //            '<div class="container-fluid" style="display: flex; justify-content: center;">' +
            //            '<button type="button" class="btn btn-primary moreless less">Show Less</a>' +
            //            '</div>' +
            //            '</div>';

            //        content.html(html);
            //    }
            //});

            jQuery(".moreless").click(function () {
                var thisEl = jQuery(this);
                var tX = ".truncate-text";
                var cT = thisEl.closest(tX);

                if (thisEl.hasClass("less")) {
                    console.log("Less");
                    cT.toggle();
                    cT.prev(tX).fadeToggle();
                } else {
                    console.log("More");
                    cT.toggle();
                    cT.next(tX).fadeToggle();
                }
                return false;
            });
            /* end iffe */

            jQuery('.content-btn').on('click', function () {
                jQuery(this).next('.showContent').find('li').toggle();
            });

            size_li = jQuery("#feedback-list li").length;
            cur_show = 3;
            jQuery('#showless-btn').hide();
            jQuery('#feedback-list li:lt(' + cur_show + ')').show();

            jQuery('#showmore-btn').click(function () {
                cur_show = (cur_show + 5 <= size_li) ? cur_show + 5 : size_li;
                jQuery('#feedback-list li:lt(' + cur_show + ')').show();
                jQuery('#showless-btn').show();
                if (cur_show == size_li) {
                    jQuery('#showmore-btn').hide();
                }
            });

            jQuery('#showless-btn').click(function () {
                cur_show = (cur_show - 5 < 0) ? 3 : cur_show - 5;
                jQuery('#feedback-list li').not(':lt(' + cur_show + ')').hide();
                jQuery('#showmore-btn').show();
                jQuery('#showless-btn').show();
                if (cur_show == 3) {
                    jQuery('#showless-btn').hide();
                }
            });

        })();

        /* end ready */
    });
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>
    var currentEditPlace = null;
    var currentUploadPond = null;
    var currentElement = null;
    var previousElement = null;
    var numOfTaskDone = 0;
    var inUploadProgress = false;
    function stopVideo(element) {

        var iframe = element.find('iframe')[0];
        var video = element.find('video')[0];

        if (iframe) {
            var iframeSrc = iframe.src;
            iframe.src = iframeSrc;
        }
        if (video) {
            video.pause();
        }

    }

    function togglePopupVideo(video, activeState) {
        
        video = jQuery(video);
        video.toggleClass("active", activeState);
        if (!activeState) {
            stopVideo(video);
        }
    }
    function DisplayError(message) {
        swal({
            title: "Something is wrong",
            text: message,
            icon: "error",
            button: "Ok",
        });
    }
    function EditImage() {
        if (currentEditPlace) {
            return DisplayError("Complete your edit first!");
        }
        currentEditPlace = "image";
        currentUploadPond = null;
        previousElement = jQuery("#cover-image-container");
        currentElement = jQuery('#main-information-container[name="image"]');
        previousElement[0].setAttribute("hidden", null);
        currentElement.removeAttr("hidden");
    }
    function EditDetail() {
        if (currentEditPlace) {
            return DisplayError("Complete your edit first!");
        }
        currentEditPlace = "detail";
        currentUploadPond = null;
        currentElement = jQuery('#main-information-container[name="detail"]');
        previousElement = jQuery(".container-fluid#details");
        currentElement.removeAttr("hidden");
        previousElement[0].setAttribute("hidden", null);

    }
    function EditContent(courseId,element) {
        if (currentEditPlace) {
            return DisplayError("Complete your edit first!");
        }
        currentEditPlace = "content";
        currentUploadPond = null;
        currentElement = jQuery(`#main-information-container.container-fluid[name=${courseId}]`);
        previousElement = jQuery(`#content-list-item.list-item[name=${courseId}]`);
        currentElement.removeAttr("hidden");
        previousElement[0].setAttribute("hidden", null);
    }
    function Cancel() {
        if (inUploadProgress)
            return DisplayError("Complete upload progress first!");
        if(currentElement)
            currentElement[0].setAttribute("hidden", null);
        if (previousElement)
            previousElement.removeAttr("hidden");
        currentEditPlace = null;
        
    }

    function Save(id) {
        if (inUploadProgress) {
            return DisplayError("Complete upload progress first!");
        }
        if (!currentUploadPond) {
            if (currentEditPlace === "image") {
                return DisplayError("Image cover is empty!");
            }
            if (currentEditPlace === "content") {
                return DisplayError("Section miss main video");
            }
        }
        
        if (currentEditPlace === "image") {
            AjaxRequest(() => {
                inUploadProgress = true;
                currentUploadPond[0].callbackSubmit(currentUploadPond[0].fieldName, currentUploadPond[0].file, (error) => {
                    //Cancel();
                    OnUploadDone(error);
                });

            });
        }
        else if (currentEditPlace === "content") {
            const lectureName = document.querySelectorAll('#main-information-lecture')[id-1].value;
            if (lectureName.length === 0) {
                return DisplayError("Lecture name is empty");
            }
            AjaxRequest(() => {
                inUploadProgress = true;
                for (var i = 0; i < currentUploadPond.length; i++) {
                    currentUploadPond[i].callbackSubmit(currentUploadPond[i].fieldName, currentUploadPond[i].file, (error) => {
                        numOfTaskDone++;
                        if (numOfTaskDone === currentUploadPond.length) {
                            const courseId = "{{detailCourse.id}}"
                            $.post(`/lecturer/editCourse/section/${courseId}`, { sectionId: id, lectureName: lectureName }, function (err, status) {
                                //Cancel();
                                OnUploadDone(err);
                            })
                        }

                    });
                }
            });
        }
        else {
            const courseName = jQuery('#main-information-name').val();
            const field = jQuery('#main-information-field').val();
            const subField = jQuery('#main-information-subfield').val();
            const shortDescription = jQuery('#main-information-sdesc').val();
            const description = jQuery('#editor').children(".ql-editor")[0].innerHTML;
            const price = jQuery('#main-information-fee').val();
            const status = jQuery('#main-information-status').val();
            if (!CheckValidInput(courseName, shortDescription, description, price))
                return;
            AjaxRequest(() => {
                inUploadProgress = true;
                const courseId = "{{detailCourse.id}}";
                $.post(`/lecturer/editCourse/details/${courseId}`, {
                    courseName: courseName,
                    field: field,
                    subField: subField,
                    shortDescription: shortDescription,
                    description: description,
                    price: price,
                    status: status
                }, function (err, status) {
                        //Cancel();
                        OnUploadDone(err);
                })
            });
        }
    }
    function AjaxRequest(callback) {

        //swal({
        //    title: "Are you sure?",
        //    text: "Please confirm your choice!",
        //    type: "warning",
        //    showCancelButton: true,
        //    confirmButtonColor: "#DD6B55",
        //    confirmButtonText: "Yes",
        //    closeOnConfirm: false
        //}).then((isConfirm) => {
        //    if(isConfirm)
        //        callback();
        //});
        swal({
            title: "Are you sure?",
            text: "Please confirm your choice!",
            icon: "warning",
            confirmButtonClass: "btn-danger",
            buttons: true,
            confirm: {
                text: "OK",
                value: true,
                visible: true,
                className: "",
                closeModal: false
            }
        }).then((value) => {
            if(value)
                callback();
        })
    }
    function CheckValidInput(cName, shortDesc, desc, price) {
        if (cName.length === 0) {
            DisplayError("Course name is empty!");
            return false;
        }
        if (shortDesc.length === 0) {
            DisplayError("Short description is empty!");
            return false;
        }
        if (desc.length === 0) {
            DisplayError("Description is empty!");
            return false;
        }
        if (price.length === 0) {
            DisplayError("Price is empty!");
            return false;
        }
        return true;
    }

    function OnUploadDone(err) {
        inUploadProgress = false;
        currentUploadPond = null;
        if (err) {
            DisplayError(err);
            //return setTimeout(() => { location.reload() }, 1000);
        }
        swal({
            title: "Success!",
            text: "Edit course successfully!",
            icon: "success",
        }).then(() => {
            location.reload();
        });
    }


    function OnFieldChange(sel) {
        document.querySelectorAll("#main-information-subfield option").forEach((ele, index) => {
            if (ele.getAttribute("id") === sel.value) {
                ele.removeAttribute("hidden");
                ele.parentNode.value = ele.value;
            }
            else {
                ele.setAttribute("hidden", null);
            }
        });
    }
</script>

{{/section}}

<!-- Header -->
<header id="head" class="secondary">
    <div class="container">

        <h1>Courses</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing eliras scele!</p>

    </div>
</header>
<!-- ./Header -->
<!-- Main -->
<!-- Main panel -->
<div class="container-fluid">
    <div class="row">
        <div class="col-md-3">
            <div class="panel panel-default sidebar-categories">
                <div class="panel-heading">Categories</div>

                <div class="list-group">
                    {{#each listCourseFields}}
                    {{#if this.isActive}}
                    <a href="/course/byField/{{this.name}}/?page=1" class="list-group-item active">
                        {{else}}
                        <a href="/course/byField/{{this.name}}/?page=1" class="list-group-item">
                            {{/if}}
                            <span class="badge">{{this.courseNumber}}</span>
                            {{this.name}}
                        </a>
                        {{/each}}
                </div>
            </div>
        </div>

        <div class="col-md-9">
            <div class="panel panel-default main-categories">
                <div class="panel-heading">Course Details</div>

                <div class="container-fluid">
                    <!-- Cover image -->
                    <div id="cover-image-detail" class="row">
                        <div id="cover-image-container" class="container">
                            <img class="img-responsive center-block" src="{{detailCourse.imagePath}}" alt="Cover Image">

                            <a id="cover-image-edit-btn" href="javascript:EditImage()" class="btn btn-primary" role="button">
                                Edit
                                <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                            </a>

                        </div>

                        <!-- EDIT HERE YOU BLIND PEOPLE -->

                        <div id="main-information-container" name="image" class="container-fluid" hidden>
                            <form id="edit-cover-image" method="POST">
                                <div id="main-information-input-group" class="input-group form-group">
                                    <label id="main-label" for="main-information-cover-img">Cover image (Image type;
                                        600x400
                                        above; &leq;10MB)</label>
                                    <input name="coverImage" type="file" id="main-information-cover-img">
                                </div>
                            </form>

                            <div id="edit-btn-container" class="row">
                                <button id="cancel-change-btn" class="btn btn-primary" onclick="Cancel()    ">
                                    Cancel
                                </button>

                                <button id="save-change-btn" class="btn btn-success" onclick="Save()">
                                    Save
                                </button>
                            </div>

                        </div>
                    </div>

                    <div id="course-info-detail" class="row">
                        <div class="container-fluid" id="details">

                            <h1>
                                Details
                            </h1>

                            <a id="details-edit-btn" href="javascript:EditDetail()" class="btn btn-primary" role="button">
                                Edit
                                <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                            </a>

                            <h2>
                                Information
                            </h2>
                            <div id="title">
                                {{detailCourse.title}}
                            </div>
                            <div id="tuition-fee">
                                $ {{detailCourse.price}}
                            </div>
                            <div id="short-description">
                                {{detailCourse.briefDescription}}
                            </div>
                            <div id="field">
                                {{detailCourse.fieldName}}
                            </div>
                            <div id="lecturer">
                                Created by
                                <a href="#lecturerInfo">{{lecturer.name}}</a>
                            </div>
                            <div id="review">
                                <i class="fa fa-eye" aria-hidden="true"></i> Views {{detailCourse.view}},&nbsp;
                                <i class="fa fa-heart-o" aria-hidden="true"></i> Likes {{detailCourse.likes}},&nbsp;
                                <i class="fa fa-user" aria-hidden="true"></i> Students {{detailCourse.enrollNumber}}
                            </div>
                            <div id="last-update">
                                Last updated {{detailCourse.lastUpdate}}
                            </div>

                            <h2>
                                Description
                            </h2>
                            <div id="description" class="truncate">
                                {{{detailCourse.description}}}
                            </div>

                            <h2>
                                Status
                            </h2>
                            <div id="status" class="truncate">
                                Complete
                            </div>
                        </div>

                        <!-- EDIT HERE YOU BLIND PEOPLE -->

                        <div id="main-information-container" name="detail" class="container-fluid" hidden>
                            <h1>
                                Details
                            </h1>

                            <form id="edit-details" method="POST">

                                <div id="main-information-input-group" class="input-group form-group">
                                    <label id="main-label" for="main-information-name">Course name</label>
                                    <input name="courseName" id="main-information-name" type="text"
                                           class="form-control" maxlength="70">
                                </div>


                                <div id="main-information-input-group" class="input-group form-group">
                                    <label id="main-label" for="main-information-field">Field</label>
                                    <div id="main-information-field-container" class="container-fluid">
                                        <select id="main-information-field" name="field" class="form-control" onchange="OnFieldChange(this);">
                                            {{#each listCourseFields}}
                                            <option value="{{this.name}}">{{this.name}}</option>
                                            {{/each}}
                                        </select>
                                    </div>
                                </div>

                                <div id="main-information-input-group" class="input-group form-group">
                                    <label id="main-label" for="main-information-field">SubField</label>
                                    <div id="main-information-field-container" class="container-fluid">
                                        <select id="main-information-subfield" name="subField" class="form-control">
                                            {{#each listCourseFields}}
                                            {{#each listTheme}}
                                            {{#if (eq ../name "Business")}}
                                            <option id="{{../name}}" value="{{name}}">{{name}}</option>
                                            {{else}}
                                            <option id="{{../name}}" value="{{name}}" hidden>{{name}}</option>
                                            {{/if}}
                                            {{/each}}
                                            {{/each}}
                                        </select>
                                    </div>
                                </div>


                                <div id="main-information-input-group" class="input-group form-group">
                                    <label id="main-label" for="main-information-sdesc">Short description</label>
                                    <input name="shortDescription" id="main-information-sdesc" type="text"
                                           class="form-control" maxlength="100">
                                </div>

                                <div id="main-information-input-group" class="input-group form-group">
                                    <label id="main-label" for="main-information-desc">Description</label>
                                    <div id="editor"></div>

                                </div>

                                <div id="main-information-input-group" class="input-group form-group">
                                    <label id="main-label" for="main-information-fee">Tuition Fee</label>
                                    <input name="fee" id="main-information-fee" type="text" class="form-control" onkeypress="return /[0-9]/i.test(event.key)" maxlength="10">
                                </div>

                                <div id="main-information-input-group" class="input-group form-group">
                                    <label id="main-label" for="main-information-status">Status</label>

                                    <div id="main-information-status-container" class="container-fluid">
                                        <select id="main-information-status" name="status" class="form-control">
                                            <option value="complete">Complete</option>
                                            <option value="incomplete">Incomplete</option>
                                        </select>
                                    </div>

                                </div>
                            </form>

                            <div id="edit-btn-container" class="row">
                                <button id="cancel-change-btn" class="btn btn-primary" onclick="Cancel()">
                                    Cancel
                                </button>

                                <button id="save-change-btn" class="btn btn-success" onclick="Save()">
                                    Save
                                </button>
                            </div>

                        </div>

                        <div class="container-fluid" id="content">
                            <h1>
                                Content
                            </h1>

                            <h2>
                                {{detailCourse.briefDescription}}
                            </h2>

                            <p>
                                <i class="fa fa-circle-o" aria-hidden="true"></i>
                                {{detailCourse.totalHours}} hours
                                <i class="fa fa-circle-o" aria-hidden="true"></i>
                                {{numberOfSection}} sections
                            </p>

                            <div class="list-group">
                                {{#each listSections}}
                                <div id="content-list-item" class="list-item" name="{{this.id}}">
                                    <button type="button" id="list-btn" class="btn btn-primary content-btn">
                                        <i class="fa fa-angle-down pull-right" aria-hidden="true"></i>
                                        Section {{this.id}}
                                    </button>

                                    <ul class="showContent">
                                        <li>
                                            {{#with this.preview}}
                                            <div id="preview-duration{{../id}}" class="pull-right"></div>
                                            <a href="#currentvideo" onclick="togglePopupVideo(preview{{../id}}, true);">
                                                Preview
                                            </a>
                                            <div class="popupVideo" id="preview{{../id}}">
                                                <video src="{{../preview}}" type="video/mp4" controls="true"></video>
                                                <img src="/views/assets/images/closebutton.png" class="close-btn"
                                                    onclick="togglePopupVideo(preview{{../id}}, false);">
                                            </div>
                                            <script type="text/javascript">
                                                function RenderDuration(videoId, durationId) {
                                                    document.getElementById(`${videoId}`).children[0].onloadedmetadata =
                                                        function () {
                                                            const duration_s = this.duration;
                                                            const min = Math.floor(duration_s / 60);
                                                            const sec = Math.ceil(duration_s % 60);
                                                            const duration = min.toString().padStart(2, 0) + ':' + sec
                                                                .toString().padStart(2, 0);
                                                            document.getElementById(durationId).textContent = duration;
                                                        };
                                                }
                                                RenderDuration("preview{{../id}}", "preview-duration{{../id}}");
                                            </script>
                                            {{/with}}

                                        </li>
                                        <li>
                                            <div id="lecture-duration{{this.id}}" class="pull-right"></div>
                                            <a href="#currentvideo"
                                                onclick="togglePopupVideo(lecture{{this.id}}, true);">
                                                {{this.title}}
                                            </a>

                                            <div class="popupVideo" id="lecture{{this.id}}">
                                                <video
                                                    src="/resource/private/course/{{../detailCourse.id}}/{{this.id}}.mp4"
                                                    type="video/mp4" controls="true"></video>
                                                <img src="/views/assets/images/closebutton.png" class="close-btn"
                                                    onclick="togglePopupVideo(lecture{{this.id}}, false);">
                                            </div>

                                            <script type="text/javascript">
                                                function RenderDuration(videoId, durationId) {
                                                    document.getElementById(`${videoId}`).children[0].onloadedmetadata =
                                                        function () {
                                                            const duration_s = this.duration;
                                                            const min = Math.floor(duration_s / 60);
                                                            const sec = Math.ceil(duration_s % 60);
                                                            const duration = min.toString().padStart(2, 0) + ':' + sec
                                                                .toString().padStart(2, 0);
                                                            document.getElementById(durationId).textContent = duration;
                                                        };
                                                }
                                                RenderDuration("lecture{{this.id}}", "lecture-duration{{this.id}}");
                                            </script>
                                        </li>
                                    </ul>

                                    <a id="content-edit-btn" onclick="EditContent({{this.id}},this)" class="btn btn-primary" role="button">
                                        Edit
                                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                    </a>
                                </div>

                                <!-- EDIT HERE YOU BLIND PEOPLE -->

                                <div id="main-information-container" class="container-fluid" name="{{this.id}}" hidden>
                                    <div id="main-information-input-group" class="input-group form-group">
                                        <div id="main-information-content" class="list-group container-fluid">
                                            <form id="add-new-content" method="POST">
                                                <div id="main-information-section-list" class="list-item">
                                                    <button type="button" id="list-btn"
                                                        class="btn btn-primary content-btn">
                                                        Section {{this.id}}
                                                    </button>

                                                    <ul id="mainContent" class="container-fluid">
                                                        <li>
                                                            <label id="main-label"
                                                                for="main-information-lecture">Lecture
                                                                Name</label>
                                                            <input name="lecture" id="main-information-lecture"
                                                                type="text" class="form-control" value="{{this.title}}">
                                                        </li>
                                                        <li>
                                                            <label id="main-label"
                                                                for="main-information-lecture-video">Lecture
                                                                video</label>
                                                            <input name="mainVideo" type="file"
                                                                id="main-information-course-video">
                                                        </li>
                                                        <li>
                                                            <label id="main-label"
                                                                for="main-information-lecture-preview">Lecture
                                                                preview</label>
                                                            <input name="previewVideo" type="file"
                                                                id="main-information-preview-video">
                                                        </li>

                                                        {{!-- <div id="delete-content-btn-container" class="container-fluid">
                                                <button type="button" id="delete-content-btn"
                                                    class="btn btn-danger content-btn">
                                                    Delete lecture
                                                </button>
                                            </div> --}}

                                                    </ul>

                                                    {{!-- <div id="add-list-btn-container" class="container-fluid">
                                            <button type="button" id="add-list-btn" class="btn btn-success content-btn">
                                                Add new lecture
                                            </button>
                                        </div> --}}

                                                </div>
                                            </form>
                                        </div>
                                    </div>

                                    <div id="edit-btn-container" class="row">
                                        <button id="cancel-change-btn" class="btn btn-primary" onclick="Cancel({{this.id}})">
                                            Cancel
                                        </button>

                                        <button id="save-change-btn" class="btn btn-success" onclick="Save({{this.id}})">
                                            Save
                                        </button>
                                    </div>
                                </div>

                                {{/each}}

                                <!-- EDIT HERE YOU BLIND PEOPLE -->
                                <div id="main-information-container" class="container-fluid">
                                    <div id="main-information-input-group" class="input-group form-group">
                                        <div id="main-information-content" class="list-group container-fluid">
                                            <form id="edit-content" method="POST">
                                                <div id="main-information-section-list" class="list-item">
                                                    <button type="button" id="list-btn"
                                                        class="btn btn-primary content-btn">
                                                        Section ?
                                                    </button>

                                                    <ul id="mainContent" class="container-fluid">
                                                        <li>
                                                            <label id="main-label"
                                                                for="main-information-lecture">Lecture
                                                                Name</label>
                                                            <input name="lecture" id="main-information-lecture"
                                                                type="text" class="form-control">
                                                        </li>
                                                        <li>
                                                            <label id="main-label"
                                                                for="main-information-lecture-video">Lecture
                                                                video</label>
                                                            <input name="mainVideo" type="file"
                                                                id="main-information-course-video">
                                                        </li>
                                                        <li>
                                                            <label id="main-label"
                                                                for="main-information-lecture-preview">Lecture
                                                                preview</label>
                                                            <input name="previewVideo" type="file"
                                                                id="main-information-preview-video">
                                                        </li>

                                                        {{!-- <div id="delete-content-btn-container" class="container-fluid">
                                                <button type="button" id="delete-content-btn"
                                                    class="btn btn-danger content-btn">
                                                    Delete lecture
                                                </button>
                                            </div> --}}

                                                    </ul>

                                                    {{!-- <div id="add-list-btn-container" class="container-fluid">
                                            <button type="button" id="add-list-btn" class="btn btn-success content-btn">
                                                Add new lecture
                                            </button>
                                        </div> --}}

                                                </div>
                                            </form>
                                        </div>
                                    </div>

                                    <div id="edit-btn-container" class="row">
                                        <button id="cancel-change-btn" class="btn btn-primary">
                                            Cancel
                                        </button>

                                        <button id="save-change-btn" class="btn btn-success">
                                            Save
                                        </button>
                                    </div>
                                </div>

                                <div id="add-course-btn-container" class="container-fluid">
                                    <button type="button" id="add-course-btn" class="btn btn-success content-btn">
                                        Add new section
                                    </button>
                                </div>

                            </div>
                        </div>

                        <div class="container-fluid" id="related-courses">
                            <h1>
                                Related Courses
                            </h1>
                            {{#each relatedCourses}}
                            <div id="related-course" class="media">
                                <div id="related-course-img" class="pull-left">
                                    <img class="media-object" src="{{imagePath}}" alt="Hello">
                                    <a id="related-course-transaction-btn" href="/course/detail/{{id}}"
                                        class="btn btn-primary" role="button">
                                        Details
                                    </a>
                                </div>
                                <div class="media-body">
                                    <h4 class="media-heading">
                                        <div id="fee-related-course" class="pull-right">$ {{price}}</div>
                                        {{title}}
                                    </h4>
                                    <div id="description">
                                        {{briefDescription}}
                                    </div>
                                    <div id="field">
                                        {{fieldName}}
                                    </div>
                                    <div id="lecturers">
                                        {{lecturerName}}
                                    </div>
                                    <div id="reviews">
                                        <i class="fa fa-eye" aria-hidden="true"></i> Views {{view}},&nbsp;
                                        <i class="fa fa-heart-o" aria-hidden="true"></i> Likes {{likes}},&nbsp;
                                        <i class="fa fa-user" aria-hidden="true"></i> Students {{enrollNumber}}
                                    </div>
                                </div>
                            </div>
                            {{/each}}
                        </div>

                        <div class="container-fluid" id="lecturers">
                            <h1 id="lecturerInfo">
                                Lecturers
                            </h1>
                            {{#with lecturer}}
                            <div id="lecturer" class="media">
                                <div id="lecturer-img" class="pull-left">
                                    <img class="media-object" src="/resource/public/lecturer/{{id}}.png"
                                        alt="portfolio">
                                </div>
                                <div class="media-body">
                                    <h4 id="lecturer-name" class="media-heading">
                                        {{name}}
                                    </h4>
                                    <div id="lecturer-mail">
                                        <i class="fa fa-envelope-o" aria-hidden="true"></i>
                                        {{email}}
                                    </div>
                                    <div id="lecturer-phone">
                                        <i class="fa fa-phone" aria-hidden="true"></i>
                                        {{phone_number}}
                                    </div>
                                    <div id="lecturer-universe">
                                        <i class="fa fa-map-marker" aria-hidden="true"></i>
                                        {{university}}
                                    </div>
                                </div>
                            </div>
                            {{/with}}
                        </div>

                        <div class="container-fluid" id="feedbacks">
                            <h1>
                                Feedbacks
                            </h1>

                            {{#if isEnrolled}}
                            <div class="container-fluid" id="feedback-form">
                                <div class="row" id="user-name">
                                    <h3>
                                        {{user.name}}
                                    </h3>
                                </div>

                                <form role="form" method="POST">
                                    <div class="row" id="feedback-section">
                                        <textarea name="userfeedback" class="form-control" rows="3" maxlength="1024"
                                            placeholder="Your feedback..." onkeyup="countChar(this)"></textarea>
                                        <div id="char-number">1024</div>
                                    </div>

                                    <div class="row" id="form-submit-btn">
                                        <button type="submit" class="btn btn-primary">Submit</button>
                                    </div>
                                </form>

                            </div>
                            {{/if}}

                            <div class="container-fluid" id="feedbacks">
                                <ul class="list-group" id="feedback-list">
                                    {{#each listFeedbacks}}
                                    <li class="list-group-item">
                                        <h3>{{this.name}}</h3>
                                        <h4>{{this.date}}</h4>
                                        {{{this.comment}}}
                                    </li>
                                    {{/each}}
                                </ul>

                                <div id="showmore-btn" class="container-fluid">
                                    <button class="btn btn-primary">
                                        Show More
                                    </button>
                                </div>


                                <div id="showless-btn" class="container-fluid">
                                    <button class="btn btn-primary">
                                        Show Less
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>

            </div>

        </div>

    </div>

</div>