{{#section 'js'}}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<script>
    function NextPage() {
        const pageActive = parseInt(jQuery(".pagination")[0].querySelector(".active").textContent) + 1;
        const maxPage = jQuery(".pagination")[0].querySelectorAll("li").length - 2;
        if (pageActive - 1 >= maxPage)
            return;
        const url = `?page=${pageActive}`;
        location.replace(url);

    }

    function PreviousPage() {
        const pageActive = parseInt(jQuery(".pagination")[0].querySelector(".active").textContent) - 1;
        if (pageActive + 1 <= 1)
            return;
        const url = `?page=${pageActive}`;
        location.replace(url);
    }
    jQuery(function () {
        const pagination = jQuery(".pagination")[0];
        if (pagination === null || pagination === undefined) {
            return;
        }
        const pageActive = parseInt(pagination.querySelector(".active").textContent);
        const maxPage = pagination.querySelectorAll("li").length - 2;
        if (pageActive <= 1) {
            pagination.querySelector("#previousPage").className += "disabled";
        }
        if (pageActive >= maxPage) {
            pagination.querySelector("#nextPage").className += "disabled";
        }
    });

    function Remove(button) {

        const id = jQuery(button).data("id");
        const name = button.getAttribute("name");
        const container = button;
        Warning(`Ban student ${name}!\nOnce confirm you will not be able to recover this action!`, () => {
            $.post('/admin/ban/student', {
                id: id
            }, function (err, status) {
                if (err) {
                    return DisplayError(err);
                }
                swal(`Success`, {
                    icon: "success",
                    buttons: "OK",
                }).then(() => {
                    jQuery(container).prev().css("display", "");
                    jQuery(container).css("display", "none");
                });
            })
        });
    }

    function Unlock(button) {
        const id = jQuery(button).data("id");
        const container = button;
        $.post('/admin/unlock/student', {
            id: id
        }, function (err, status) {
            if (err) {
                return DisplayError(err);
            }
            swal(`Success`, {
                icon: "success",
                buttons: "OK",
            }).then(() => {
                jQuery(container).next().css("display", "");
                jQuery(container).css("display", "none");
            });
        })

    }

    function Warning(message, callback) {
        swal({
            title: "Are you sure?",
            text: message,
            icon: "warning",
            buttons: true,
            dangerMode: true,
        }).then((willDelete) => {
            if (willDelete) {
                callback();
            }
        });
    }

    function DisplayError(message) {
        swal({
            title: "Something is wrong",
            text: message,
            icon: "error",
            button: "Ok",
        });
    }
</script>
{{/section}}

<!-- Header -->
<header id="head" class="secondary">
    <div class="container">

        <h1>Management Tools</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing eliras scele!</p>

    </div>
</header>
<!-- ./Header -->
<!-- Main -->
<!-- Main panel -->
<div class="container-fluid">
    <div class="row">

        <div class="col-md-3">
            <div id="user-sidebar" class="panel panel-default sidebar-categories">
                <div class="panel-heading">Tools</div>

                <div class="list-group">
                    <a href="/admin/categoriesManagement" class="list-group-item">
                        Categories Management
                    </a>

                    <a href="#currentPage" class="list-group-item active">
                        Students Management
                    </a>

                    <a href="/admin/lecturersManagement" class="list-group-item">
                        Lecturers Management
                    </a>

                </div>
            </div>
        </div>

        <div class="col-md-9">
            <div id="user-information" class="panel panel-default main-categories">

                <div class="panel-heading">
                    <div id="heading-information-container" class="container-fluid">

                        <div id="heading-information-container-row-admin" class="row">
                            <div id="heading-information-admin" class="col-md-3">
                                Students
                            </div>
                        </div>

                    </div>
                </div>

                <div id="main-information-container" class="container-fluid">

                    <div id="category" class="row">
                        <div class="container-fluid">

                            <div id="main-category" class="row">
                                {{#each listStudent}}
                                <div id="main-category-container" class="container-fluid">

                                    <label>{{this.name}}</label>

                                    <div id="main-category-btn-group" class="btn-group">
                                        {{#if this.block}}
                                        <a id="unlock-btn" onclick="Unlock(this)" class="btn btn-success content-btn"
                                            role="button" name="{{this.name}}" data-id="{{this.id}}">
                                            Remove Ban
                                        </a>
                                        <a id="remove-btn" onclick="Remove(this)" class="btn btn-danger content-btn"
                                            role="button" name="{{this.name}}" data-id="{{this.id}}"
                                            style="display:none">
                                            Ban
                                        </a>
                                        {{else}}
                                        <a id="unlock-btn" onclick="Unlock(this)" class="btn btn-success content-btn"
                                            role="button" name="{{this.name}}" data-id="{{this.id}}"
                                            style="display:none">
                                            Remove Ban
                                        </a>
                                        <a id="remove-btn" onclick="Remove(this)" class="btn btn-danger content-btn"
                                            role="button" name="{{this.name}}" data-id="{{this.id}}">
                                            Ban
                                        </a>
                                        {{/if}}
                                    </div>

                                </div>
                                {{/each}}
                            </div>

                            {{#with pageNumbers}}
                            <div id="user-pagination">
                                <ul class="pagination">
                                    <li id="previousPage"><a href="javascript:PreviousPage();"
                                            class="disable">&laquo;</a></li>
                                    {{#each this}}
                                    {{#if this.isActive}}
                                    <li class="active">
                                        <a href="?page={{this.value}}">
                                            {{this.value}} <span class="sr-only">(current)</span>
                                        </a>
                                    </li>
                                    {{else}}
                                    <li><a href="?page={{this.value}}">{{this.value}}</a></li>
                                    {{/if}}
                                    {{/each}}
                                    <li id="nextPage"><a href="javascript:NextPage();">&raquo;</a> </li>
                                </ul>
                            </div>
                            {{/with}}
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>